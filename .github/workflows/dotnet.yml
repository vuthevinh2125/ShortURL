name: .NET CI - TinyUrlWebApp Build & Test

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  # Fix L·ªói Path/Extension: S·ª≠ d·ª•ng t√™n file ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n tr√™n GitHub
  SOLUTION_FILE: TinyUrlWebApp.slnx 
  DOTNET_VERSION: '8.0.x' 

jobs:
  build-and-test:
    # Fix L·ªói Case Sensitivity: Chuy·ªÉn sang Windows Runner
    runs-on: windows-latest 

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: Restore dependencies
      # Kh√¥i ph·ª•c g√≥i NuGet
      run: dotnet restore ${{ env.SOLUTION_FILE }}

    # üî• Fix L·ªói CS0246 (xUnit): K·∫øt h·ª£p Build v√† Test
    - name: Build and Run Unit Tests
      # L·ªánh n√†y s·∫Ω t·ª± ƒë·ªông Build (bi√™n d·ªãch) c√°c d·ª± √°n sau khi Restore, 
      # v√† ch·∫°y ki·ªÉm th·ª≠ (test), ho√†n t·∫•t quy tr√¨nh CI
      run: dotnet test ${{ env.SOLUTION_FILE }} --configuration Release --verbosity normal
      # Thay th·∫ø b∆∞·ªõc Build v√† Test b·∫±ng l·ªánh dotnet test duy nh·∫•t.
      # L·ªánh n√†y s·∫Ω t·ª± ƒë·ªông build d·ª± √°n tr∆∞·ªõc khi ch·∫°y test, v√† th∆∞·ªùng x·ª≠ l√Ω l·ªói CS0246 t·ªët h∆°n.
      run: dotnet test ${{ env.SOLUTION_FILE }} --configuration Release --verbosity normal
